%\documentclass[varwidth=true, border=5pt, convert={size=640x}]{standalone}
\documentclass{beamer}
\usepackage[scale=1.5,size=a0,orientation=portrait]{beamerposter}
\geometry{margin=10mm}
\usepackage{tikz}
\usetikzlibrary{positioning,shapes,arrows,backgrounds,calc,fit,trees,arrows.meta,external}
\newlength{\myimscale}

\usepackage[export]{adjustbox}
\usepackage{multirow}

\tikzstyle{dummy} = []
\tikzstyle{line} = [draw, line width=1pt, -latex']
\tikzstyle{headless_line} = [draw, line width=1pt, -]
\tikzstyle{default}    = [rectangle, text centered, rounded corners, text=black, font=\sffamily\footnotesize, align=center]
\tikzstyle{default_text}    = [rectangle, text width=18cm, text=black,anchor=north west, font=\sffamily]
\tikzstyle{boxwhite} = [default, fill=white, rounded corners=0.2cm]
\tikzstyle{cp}    = [default, fill=seaborn_blue, text=white, text width=4.8cm, minimum height=1.0cm]
\tikzstyle{pw}    = [cp, fill=seaborn_green]
\tikzstyle{kcw}    = [cp, fill=seaborn_orange]
\tikzstyle{wannier90}    = [cp, fill=seaborn_cyan]
\tikzstyle{bespoke}    = [cp, fill=seaborn_magenta]
\tikzstyle{observable}    = [cp, fill=seaborn_red]
\tikzset{
  -|-/.style={
    to path={
      (\tikztostart) -| ($(\tikztostart)!#1!(\tikztotarget)$) |- (\tikztotarget)
      \tikztonodes
    }
  },
  -|-/.default=0.5,
  |-|/.style={
    to path={
      (\tikztostart) |- ($(\tikztostart)!#1!(\tikztotarget)$) -| (\tikztotarget)
      \tikztonodes
    }
  },
  |-|/.default=0.5,
}

\newlength{\myyshift}
\setlength{\myyshift}{0.1cm}

\newcommand{\bra}[1]{\langle #1|}
\newcommand{\braket}[2]{\langle #1|#2\rangle}
\newcommand{\braopket}[3]{\langle #1|#2|#3\rangle}
\newcommand{\ket}[1]{|#1\rangle}
\newcommand{\nline}{\nonumber \\}
\newcommand{\Trace}{\mathrm{Tr}}

\usepackage{sansmath}
\sansmath
\usepackage{helvet}
\setbeamerfont{normal text}{family=helvet}
\setbeamerfont{local structure}{family=helvet}
\setbeamerfont*{block title}{series=\bf}
\definecolor{kgrey}{HTML}{2b2828}
\definecolor{kgrey_light}{HTML}{d2cfcf}
\definecolor{kgrey_verylight}{HTML}{eeeded}
\setbeamercolor{block body alert}{fg=white, bg=kgrey}
\setbeamercolor{block title}{bg=kgrey, fg=white}
\setbeamercolor{block body}{fg=kgrey, bg=white}
\setbeamertemplate{itemize item}{\color{kgrey}$\blacktriangleright$}
\beamertemplatenavigationsymbolsempty

\input{seaborn_colours}
\usepackage{siunitx,booktabs}
\renewcommand{\ttdefault}{pcr}

\usepackage{minted}
\usemintedstyle{friendly}
% \usemintedstyle{gruvbox}
% \definecolor{gruvbox_dark_bg}{HTML}{282828}
% \definecolor{gruvbox_fg}{HTML}{ebdbb2}
% \setminted[python]{bgcolor=gruvbox_dark_bg}
% \setminted[json]{bgcolor=gruvbox_dark_bg}
% \setminted[shell-session]{style=gruvbox_plain, bgcolor=gruvbox_dark_bg}


\usepackage[backend=biber, bibencoding=utf8, style=nature, maxbibnames=1, maxcitenames=1, 
            sorting=none, giveninits=true, isbn=false, doi=false, url=false]{biblatex}
\input{ref_settings}
\input{journal_abbreviations}
\addbibresource{/home/elinscott/code/koopmans/docs/refs.bib}
\setbeamercolor*{bibliography entry author}{fg=kgrey}
\setbeamercolor*{bibliography entry title}{fg=kgrey}
\setbeamercolor*{bibliography entry note}{fg=kgrey}
\setbeamertemplate{bibliography item}{}

\usepackage{tcolorbox}
\tcbuselibrary{skins,hooks}
\tcbset{colframe=structure,fonttitle=\bfseries,beamer, clip upper, boxsep=0pt, sharp corners=all, no shadow, left skip=0pt, right skip=0pt, coltext=white}

\begin{document}
\newcommand{\citeauthoryear}[1]{\citeauthor{#1} \citeyear{#1}}
\begin{frame}[t]{}

    \vspace{-0.001\paperheight}
    \setbeamercolor{banner}{fg=white,bg=kgrey}
    \begin{beamercolorbox}[wd=\textwidth,sep=1em]{banner}
        \bf
        \centering
        \huge
        \emph{Black-box, accurate, and efficient prediction of band \\ structures with Koopmans functionals}

        \vspace{0.5em}
        \large
        Edward Linscott (Laboratory for Materials Simulations)
    \end{beamercolorbox}

    \vspace{-0.001\paperheight}
    \setbeamercolor{background}{fg=white,bg=seaborn_bg_grey}
    \begin{beamercolorbox}[ht=0.776\paperheight,wd=\textwidth]{background}

        \begin{columns}[t]
            \begin{column}{0.37\linewidth}
                \begin{block}{Summary}
                    \textbf{\texttt{koopmans} has just been released!} This package contains everything you need to run a Koopmans functional calculation without expert knowledge, including implementations of Koopmans functionals in \textsc{Quantum ESPRESSO} as well as automated workflows.
                \end{block}

                \vspace{1.8ex}

                \begin{block}{1. What are Koopmans functionals?}
                    \nocite{Dabo2009,Dabo2010,Borghi2014,Colonna2018,Nguyen2018,Colonna2019,DeGennaro2022,Colonna2022}
                    Koopmans functionals are a class of functionals that aim to reproduce spectral properties (charged excitations) and total energies on the same footing, enforcing a generalised piecewise linearity condition.
                    \vspace{0.125em}
                    \begin{equation*}
                        E_\mathrm{Koopmans} = E_\mathrm{DFT} + \sum_i \alpha_i \biggl( \underbrace{- \int_0^{f_i}\varepsilon_i(f) df}_{\substack{\text{removes the erroneous} \\ \text{curvature}}} \underbrace{+ f_i\int_0^1 \varepsilon_i(f) df}_{\substack{\text{restores the}\\ \text{correct linearity}}} \biggr)
                    \end{equation*}
                    \vspace{0.125em}

                    The result: \textbf{band structures and orbital energies as accurate as state-of-the-art GW, at a fraction of the computational cost.}

                    \vspace{0.34em}
                \end{block}

            \end{column}

            \begin{column}{0.57\linewidth}

                \begin{block}{2. Example results}
                    \setlength{\tabcolsep}{5pt}
                    \renewcommand{\arraystretch}{1}
                    \vspace{0.7em}
                    \hbox{

                        \begin{minipage}[b][0.25\textwidth][t]{0.4\textwidth}
                            \textbf{Semiconductors and insulators} (top left) Band gap and ionisation potential of semiconductors and insulators compared to experiment \textcolor{kgrey_light}{\citeauthoryear{Nguyen2018}}

                            \small
                            \begin{tabular}{c c S[table-format = 2.2] S[table-format = 2.2] S[table-format = 2.2] S[table-format = 2.2] S[table-format = 2.2] S[table-format = 2.2] S[table-format = 2.2] S[table-format = 2.2] S[table-format = 2.2]}
                                                                  &             & {PBE} & {G\textsubscript{0}W\textsubscript{0}} & {KI} & {KIPZ} & {QSG$\tilde{\mathrm{W}}$} \\
                                \midrule
                                \midrule
                                \multirow{2}{*}{$E_\mathrm{gap}$} &
                                {MAE (eV)}                        & 2.54        & 0.56  & 0.27                                   & 0.22 & 0.18                               \\
                                                                  & {MAPE (\%)} & 48.28 & 12.10                                  & 7.09 & 5.37   & 4.46                      \\
                                \midrule
                                \multirow{2}{*}{IP}               &
                                {MAE (eV)}                        & 1.09        & 0.39  & 0.19                                   & 0.21 & 0.49                               \\
                                                                  & {MAPE (\%)} & 15.58 & 5.71                                   & 2.99 & 3.14   & 7.41
                            \end{tabular}

                            \vspace{1em}
                            \normalsize
                            (top right) The KI band structure of ZnO compared to the experimental band gap and $d$-band position \textcolor{kgrey_light}{\citeauthoryear{Colonna2022}}

                            \vspace{0.7em}
                            \textbf{Molecules} (bottom) The KI, pKIPZ, and KIPZ Koopmans functionals give ionization potentials comparable to qpGW across the GW100 dataset \textcolor{kgrey_light}{\citeauthoryear{Colonna2019}}

                        \end{minipage}

                        \hspace{0.5em}

                        \begin{minipage}{0.55\textwidth}
                            \vspace{-1em}
                            \begin{center}
                                \hbox{
                                    \includegraphics[width=0.5\textwidth,valign=t]{../figures/nguyen2018_bandgaps.png}
                                    \hspace{1ex}
                                    \includegraphics[width=0.45\textwidth,valign=t]{../figures/ZnO_ki_trimmed.png}
                                }

                                \vspace{1ex}

                                \includegraphics[width=0.9\columnwidth]{../figures/colonna_2019_gw100_ip.jpeg}
                            \end{center}
                        \end{minipage}

                    }
                    \hfill
                    \vspace{0.15em}

                \end{block}

            \end{column}

        \end{columns}

        % \vspace{1em}
        % \begin{columns}
        %     \begin{column}{0.968\textwidth}
        %         \begin{block}{3. Workflows}
        %             \vspace{1ex}
        %             \begin{center}
        %                 \begin{minipage}{0.85\textwidth}
        %                     Supercell implementation

        %                     \vspace{-3ex}
        %                     \input{supercell_workflow_2.tex}

        %                     \vspace{-2ex}
        %                     \noindent Primitive cell implementation

        %                     \vspace{0.5ex}
        %                     \input{primitive_workflow.tex}
        %                 \end{minipage}
        %             \end{center}
        %         \end{block}
        %     \end{column}
        % \end{columns}

        \vspace{1.2em}
        \begin{columns}[t]
            \begin{column}{0.47\textwidth}
                \begin{block}{4. What does running \texttt{koopmans} look like?}

                    \hbox{
                        \begin{minipage}[t]{0.44\columnwidth}
                            Koopmans takes a single \texttt{JSON} file as input e.g. for bulk silicon
                            \vspace{0.2em}
                            \inputminted[fontsize=\tiny, autogobble, breaklines]{json}{scripts/si_ki.json}
                        \end{minipage}
                        \hspace{0.025\columnwidth}
                        \begin{minipage}[t]{0.5\columnwidth}
                            Running from the command line looks like this:
                            \vspace{0.2em}
                            \inputminted[fontsize=\tiny, autogobble, breaklines]{shell-session}{scripts/si_ki.out}
                        \end{minipage}
                    }
                    \hfill
                    \vspace{0.86em}

                \end{block}

            \end{column}

            \begin{column}{0.47\textwidth}
                \setbeamercolor{block title}{bg=white, fg=white}
                \begin{block}{\vphantom{P}}
                    \vspace{-2.8ex}
                    or run with \texttt{python}:
                    \inputminted[fontsize=\tiny, autogobble, breaklines]{python}{scripts/si.py}
                \end{block}

                \vspace{1em}
                \setbeamercolor{block title}{bg=kgrey, fg=white}
                \begin{block}{References and Acknowledgements}
                    \vspace{0.4em}
                    \hspace{-2em}
                    \begin{minipage}{1.03\textwidth}
                        \AtNextBibliography{\tiny}
                        \printbibliography
                    \end{minipage}

                    \tiny
                    \vspace{1em}
                    This work was supported by the Swiss National Science
                    Foundation (SNSF) through its National Centre of Competence in Research (NCCR) MARVEL and Grant No.
                    200021-179138. The National Centres of Competence in Research (NCCRs) are a funding scheme of the Swiss National Science Foundation

                    \vspace{0.8em}
                    \includegraphics[height=0.07\columnwidth]{../figures/psi_trimmed.png}
                    \hfill
                    \includegraphics[height=0.07\columnwidth]{../figures/marvel_trimmed.png}
                    \hfill
                    \includegraphics[height=0.07\columnwidth]{../figures/SNF_logo_standard_print_color_pos_e.eps}
                    \vspace{0.5em}

                \end{block}
                % \begin{beamercolorbox}[wd=\textwidth,sep=1em]{logos}
                % \end{beamercolorbox}

            \end{column}
        \end{columns}

        \vspace{1.25em}

    \end{beamercolorbox}

    \begin{beamercolorbox}[wd=\textwidth,sep=1em]{banner}
        \begin{center}
            \bf \large Go to {\ttfamily \bf \large koopmans-functionals.org} to find out more!
        \end{center}
        \vspace{0.005\paperheight}
    \end{beamercolorbox}

\end{frame}
% \setlength{\myimscale}{0.08\textwidth}
% \begin{tikzpicture}[every node/.style={color=kgrey}]
%     \node[inner sep=0pt] (logo) at (3\myimscale,0\myimscale)
%     {\includegraphics[width=0.7\textwidth]{figures/k_grey_on_transparent.png}};
%     \node[rectangle, draw, thick, minimum width=5.75\myimscale, minimum height=3.5\myimscale, outer sep=0, label=above:linearisation,
%         path picture={
%                 \node at (path picture bounding box.center){
%                     \includegraphics[width=5.75\myimscale]{figures/linearisation.png}
%                 };
%             }] (linear) at (0\myimscale,5.2\myimscale) {};
%     \node[rectangle, draw, thick, minimum width=5.75\myimscale, minimum height=3.5\myimscale, outer sep=0, label=above:screening,
%         path picture={
%                 \node at (path picture bounding box.center){
%                     \includegraphics[width=5.75\myimscale]{figures/screening.png}
%                 };
%             }] (screening) at (6.25\myimscale,5.2\myimscale) {};
%     \node[rectangle, minimum width=2.5\myimscale, minimum height=3.5\myimscale, outer sep=0,
%         path picture={
%                 \node at ([yshift=-0.05\myimscale]path picture bounding box.center){
%                     \includegraphics[width=2.5\myimscale]{figures/fig_nguyen_canonical_orbital.png}
%                 };
%             }] (bloch) at (-1.5\myimscale,-5.2\myimscale) {};
%     \node[rectangle, minimum width=2.5\myimscale, minimum height=3.5\myimscale, outer sep=0,
%         path picture={
%                 \node at ([yshift=1.5\myimscale]path picture bounding box.center){
%                     \includegraphics[width=2.6\myimscale]{figures/fig_nguyen_variational_orbital.png}
%                 };
%             }] (wannier) at (1.5\myimscale,-5.2\myimscale) {};
%     \node[rectangle, draw, thick, minimum width=5.75\myimscale, minimum height=3.5\myimscale, outer sep=0, label=below:localisation,
%     ] (localisation) at (0\myimscale,-5.2\myimscale) {};
%     \node[rectangle, draw, thick, minimum width=5.75\myimscale, minimum height=3.5\myimscale, outer sep=0, label=below:automation,
%         path picture={
%                 \node at (path picture bounding box.east){
%                     \includegraphics[width=15\myimscale]{figures/dscf_workflow.png}
%                 };
%             }] (workflow) at (6.25\myimscale,-5.2\myimscale) {};
%     \draw[thick, -{Latex[round]}] (bloch) -- (wannier);
% \end{tikzpicture}

\end{document}
